# CSV æ•¸æ“šåˆ†æèˆ‡ç®¡ç†ç³»çµ±

ä¸€å€‹å°ˆæ¥­çš„æ¸¬è©¦æ•¸æ“šç®¡ç†å¹³å°ï¼Œæ”¯æ´ CSV æª”æ¡ˆåŒ¯å…¥ã€æ•¸æ“šæŸ¥è©¢ã€çµ±è¨ˆåˆ†æç­‰åŠŸèƒ½ã€‚

## å°ˆæ¡ˆçµæ§‹

```
csv_analysis_system/
â”œâ”€â”€ README.md                    # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ requirements.txt             # Python ä¾è³´å¥—ä»¶
â”œâ”€â”€ app.py                      # Flask ä¸»æ‡‰ç”¨ç¨‹å¼
â”œâ”€â”€ models.py                   # è³‡æ–™åº«æ¨¡å‹å®šç¾©
â”œâ”€â”€ csv_parser.py               # CSV è§£ææ¨¡çµ„
â”œâ”€â”€ data_service.py             # æ•¸æ“šæœå‹™å±¤
â”œâ”€â”€ config.py                   # é…ç½®æª”æ¡ˆ
â”œâ”€â”€ run.py                      # æ‡‰ç”¨å•Ÿå‹•è…³æœ¬
â”œâ”€â”€ data/                       # è³‡æ–™åº«æª”æ¡ˆç›®éŒ„
â”‚   â””â”€â”€ test_records.db         # SQLite è³‡æ–™åº«æª”æ¡ˆ
â”œâ”€â”€ uploads/                    # æª”æ¡ˆä¸Šå‚³æš«å­˜ç›®éŒ„
â”œâ”€â”€ templates/                  # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ base.html              # åŸºç¤æ¨¡æ¿
â”‚   â”œâ”€â”€ index.html             # é¦–é 
â”‚   â”œâ”€â”€ import.html            # åŒ¯å…¥é é¢
â”‚   â”œâ”€â”€ search.html            # æœå°‹é é¢
â”‚   â”œâ”€â”€ analysis.html          # åˆ†æé é¢
â”‚   â””â”€â”€ error.html             # éŒ¯èª¤é é¢
â”œâ”€â”€ static/                     # éœæ…‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ tests/                      # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ test_models.py
â”‚   â”œâ”€â”€ test_parser.py
â”‚   â”œâ”€â”€ test_service.py
â”‚   â””â”€â”€ test_api.py
â””â”€â”€ logs/                       # è¨˜éŒ„æª”ç›®éŒ„
```

## ç³»çµ±æ¶æ§‹

### æŠ€è¡“æ£§
- **å¾Œç«¯**: Python 3.8+, Flask, SQLAlchemy
- **è³‡æ–™åº«**: SQLite (å¯æ“´å±•è‡³ PostgreSQL/MySQL)
- **å‰ç«¯**: Bootstrap 5, Chart.js, Vanilla JavaScript
- **æ•¸æ“šè™•ç†**: Pandas, NumPy

### æ¶æ§‹è¨­è¨ˆåŸå‰‡
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: å„åŠŸèƒ½ç¨ç«‹æ¨¡çµ„ï¼Œä½è€¦åˆé«˜å…§èš
- **åˆ†å±¤æ¶æ§‹**: è³‡æ–™å±¤ã€æœå‹™å±¤ã€æ§åˆ¶å±¤ã€å±•ç¤ºå±¤åˆ†é›¢
- **å–®ä¸€è·è²¬**: æ¯å€‹æ¨¡çµ„åªè² è²¬ç‰¹å®šåŠŸèƒ½
- **å¯æ“´å±•æ€§**: æ”¯æ´æ°´å¹³æ“´å±•å’ŒåŠŸèƒ½æ“´å±•

## å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒéœ€æ±‚
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- pip å¥—ä»¶ç®¡ç†å™¨
- 8GB ä»¥ä¸Šè¨˜æ†¶é«” (å»ºè­°)

### 2. å®‰è£æ­¥é©Ÿ

```bash
# 1. å…‹éš†å°ˆæ¡ˆ (æˆ–ä¸‹è¼‰æ‰€æœ‰æª”æ¡ˆ)
mkdir csv_analysis_system
cd csv_analysis_system

# 2. å»ºç«‹è™›æ“¬ç’°å¢ƒ
python -m venv venv

# 3. å•Ÿå‹•è™›æ“¬ç’°å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 4. å®‰è£ä¾è³´å¥—ä»¶
pip install -r requirements.txt

# 5. å»ºç«‹å¿…è¦ç›®éŒ„
mkdir data uploads logs static/css static/js static/images

# 6. åˆå§‹åŒ–è³‡æ–™åº«
python -c "from models import init_database; init_database()"

# 7. å•Ÿå‹•æ‡‰ç”¨
python app.py
```

### 3. ç€è¦½å™¨è¨ªå•
é–‹å•Ÿç€è¦½å™¨ï¼Œè¨ªå• `http://localhost:5000`

## é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸é…ç½® (.env æª”æ¡ˆ)
```env
# è³‡æ–™åº«é…ç½®
DATABASE_URL=sqlite:///data/test_records.db

# Flask é…ç½®
FLASK_ENV=development
SECRET_KEY=your-secret-key-here

# æª”æ¡ˆä¸Šå‚³é…ç½®
MAX_CONTENT_LENGTH=16777216  # 16MB
UPLOAD_FOLDER=uploads

# æ—¥èªŒé…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

## ç¨‹å¼æµç¨‹èªªæ˜

### 1. ç³»çµ±å•Ÿå‹•æµç¨‹

```mermaid
graph TD
    A[app.py å•Ÿå‹•] --> B[è¼‰å…¥é…ç½®]
    B --> C[åˆå§‹åŒ–è³‡æ–™åº«]
    C --> D[å»ºç«‹ Flask æ‡‰ç”¨]
    D --> E[è¨»å†Šè·¯ç”±]
    E --> F[å•Ÿå‹• Web æœå‹™]
    F --> G[ç­‰å¾…ç”¨æˆ¶è«‹æ±‚]
```

### 2. CSV åŒ¯å…¥æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ¶ä¸Šå‚³ CSV] --> B[æª”æ¡ˆé©—è­‰]
    B --> C{æª”æ¡ˆæ ¼å¼æ­£ç¢º?}
    C -->|å¦| D[è¿”å›éŒ¯èª¤è¨Šæ¯]
    C -->|æ˜¯| E[è§£ææª”æ¡ˆåç¨±]
    E --> F[FilenameParser.parse]
    F --> G{æª”æ¡ˆåç¨±æ ¼å¼æ­£ç¢º?}
    G -->|å¦| H[è¨˜éŒ„éŒ¯èª¤]
    G -->|æ˜¯| I[è§£æ CSV å…§å®¹]
    I --> J[CSVDataParser.parse]
    J --> K[æ•¸æ“šé©—è­‰]
    K --> L[æª¢æŸ¥é‡è¤‡è¨˜éŒ„]
    L --> M[å¯«å…¥è³‡æ–™åº«]
    M --> N[æ›´æ–°çµ±è¨ˆè³‡è¨Š]
    N --> O[è¿”å›çµæœ]
```

### 3. æ•¸æ“šæŸ¥è©¢æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ¶è¼¸å…¥æŸ¥è©¢æ¢ä»¶] --> B[åƒæ•¸é©—è­‰]
    B --> C[å»ºç«‹æŸ¥è©¢ç‰©ä»¶]
    C --> D[æ‡‰ç”¨éæ¿¾æ¢ä»¶]
    D --> E[åŸ·è¡Œè³‡æ–™åº«æŸ¥è©¢]
    E --> F[åˆ†é è™•ç†]
    F --> G[æ ¼å¼åŒ–çµæœ]
    G --> H[è¿”å› JSON è³‡æ–™]
    H --> I[å‰ç«¯é¡¯ç¤ºçµæœ]
```

### 4. æ ¸å¿ƒæ¨¡çµ„èªªæ˜

#### models.py - è³‡æ–™æ¨¡å‹å±¤
- **TestRecord**: æ¸¬è©¦è¨˜éŒ„ä¸»è¡¨
- **ImportLog**: åŒ¯å…¥è¨˜éŒ„è¡¨
- **DatabaseManager**: è³‡æ–™åº«ç®¡ç†å™¨ (å–®ä¾‹æ¨¡å¼)

#### csv_parser.py - è§£æè™•ç†å±¤
- **FilenameParser**: æª”æ¡ˆåç¨±è§£æå™¨
- **CSVDataParser**: CSV å…§å®¹è§£æå™¨
- **DataValidator**: æ•¸æ“šé©—è­‰å™¨

#### data_service.py - æ¥­å‹™é‚è¼¯å±¤
- **DatabaseService**: è³‡æ–™åº«æ“ä½œæœå‹™
- **ImportService**: åŒ¯å…¥è™•ç†æœå‹™
- **QueryService**: æŸ¥è©¢åˆ†ææœå‹™

#### app.py - æ§åˆ¶å±•ç¤ºå±¤
- **è·¯ç”±è™•ç†**: Web è«‹æ±‚è·¯ç”±
- **API æ¥å£**: RESTful API
- **éŒ¯èª¤è™•ç†**: çµ±ä¸€éŒ¯èª¤è™•ç†

## æª”æ¡ˆåç¨±æ ¼å¼è¦ç¯„

ç³»çµ±æ”¯æ´çš„æª”æ¡ˆåç¨±æ ¼å¼ï¼š
```
SN_YYYYMMDD_HHMMSS_(left/right/rec1/rec2)

ç¯„ä¾‹ï¼š
32120121ED0755130005_20250522_084534_left
```

### æ ¼å¼èªªæ˜ï¼š
- **SN**: è¨­å‚™åºè™Ÿ (å­—æ¯æ•¸å­—çµ„åˆ)
- **YYYYMMDD**: æ¸¬è©¦æ—¥æœŸ (8ä½æ•¸å­—)
- **HHMMSS**: æ¸¬è©¦æ™‚é–“ (6ä½æ•¸å­—)  
- **æ¸¬è©¦é …ç›®**: left/right/rec1/rec2

## è³‡æ–™åº«è¨­è¨ˆ

### ä¸»è¦è³‡æ–™è¡¨

#### test_records (æ¸¬è©¦è¨˜éŒ„è¡¨)
- **ä¸»éµ**: id (è‡ªå¢)
- **å”¯ä¸€ç´„æŸ**: sn + test_date + test_time + test_type
- **ç´¢å¼•**: sn, test_date, test_type, import_time
- **é »ç‡æ¬„ä½**: freq_100 ~ freq_2000 (æ”¯æ´å¤šç¨®æ¸¬è©¦é »ç‡)

#### import_logs (åŒ¯å…¥è¨˜éŒ„è¡¨)
- **è¿½è¹¤åŒ¯å…¥éç¨‹**: æˆåŠŸ/å¤±æ•—/é‡è¤‡çµ±è¨ˆ
- **éŒ¯èª¤è¨˜éŒ„**: è©³ç´°éŒ¯èª¤è¨Šæ¯
- **æ€§èƒ½ç›£æ§**: åŒ¯å…¥æ™‚é–“è¨˜éŒ„

## API æ¥å£èªªæ˜

### ä¸»è¦ API ç«¯é»

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | åƒæ•¸ |
|------|------|------|------|
| `/api/upload` | POST | ä¸Šå‚³ CSV æª”æ¡ˆ | file, encoding |
| `/api/search` | GET | æœå°‹è¨˜éŒ„ | sn, test_date, test_type, page |
| `/api/sn/<sn>` | GET | ç²å– SN æ‰€æœ‰è¨˜éŒ„ | - |
| `/api/analysis/frequency` | GET | é »ç‡åˆ†æ | sn, frequency |
| `/api/analysis/compare` | GET | SN æ¯”è¼ƒ | sn1, sn2, frequency |
| `/api/statistics` | GET | çµ±è¨ˆè³‡è¨Š | - |
| `/api/import-history` | GET | åŒ¯å…¥æ­·å² | limit |

### å›æ‡‰æ ¼å¼
```json
{
    "success": true,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {...},
    "pagination": {...}  // åˆ†é è³‡è¨Š
}
```

## éƒ¨ç½²èªªæ˜

### é–‹ç™¼ç’°å¢ƒ
```bash
python app.py
```

### ç”Ÿç”¢ç’°å¢ƒ
```bash
# ä½¿ç”¨ Gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app

# ä½¿ç”¨ Docker (å¯é¸)
docker build -t csv-analysis .
docker run -p 8000:8000 csv-analysis
```

### Nginx é…ç½® (å¯é¸)
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /static {
        alias /path/to/csv_analysis_system/static;
    }
}
```

## æ¸¬è©¦èªªæ˜

### åŸ·è¡Œæ¸¬è©¦
```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦
pytest tests/test_models.py

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
pytest --cov=. --cov-report=html
```

### æ¸¬è©¦æ•¸æ“š
åœ¨ `tests/` ç›®éŒ„ä¸‹æº–å‚™æ¸¬è©¦ç”¨çš„ CSV æª”æ¡ˆï¼š
- `test_data_valid.csv`: æ­£ç¢ºæ ¼å¼çš„æ¸¬è©¦æ•¸æ“š
- `test_data_invalid.csv`: éŒ¯èª¤æ ¼å¼çš„æ¸¬è©¦æ•¸æ“š

## ç¶­è­·èˆ‡ç›£æ§

### æ—¥èªŒæª”æ¡ˆ
- **æ‡‰ç”¨æ—¥èªŒ**: `logs/app.log`
- **éŒ¯èª¤æ—¥èªŒ**: `logs/error.log`
- **åŒ¯å…¥è¨˜éŒ„**: è³‡æ–™åº« import_logs è¡¨

### æ€§èƒ½ç›£æ§
- ç›£æ§è³‡æ–™åº«æª”æ¡ˆå¤§å°
- æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨é‡
- ç›£æ§ API å›æ‡‰æ™‚é–“

### å‚™ä»½ç­–ç•¥
```bash
# å‚™ä»½è³‡æ–™åº«
cp data/test_records.db backup/test_records_$(date +%Y%m%d).db

# å‚™ä»½ä¸Šå‚³æª”æ¡ˆ
tar -czf backup/uploads_$(date +%Y%m%d).tar.gz uploads/
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **è³‡æ–™åº«é€£æ¥å¤±æ•—**
   - æª¢æŸ¥ `data/` ç›®éŒ„æ¬Šé™
   - ç¢ºèª SQLite æª”æ¡ˆå­˜åœ¨

2. **CSV è§£æå¤±æ•—**
   - æª¢æŸ¥æª”æ¡ˆåç¨±æ ¼å¼
   - ç¢ºèªæª”æ¡ˆç·¨ç¢¼ (UTF-8)

3. **è¨˜æ†¶é«”ä¸è¶³**
   - åˆ†æ‰¹è™•ç†å¤§å‹ CSV æª”æ¡ˆ
   - å¢åŠ ç³»çµ±è¨˜æ†¶é«”

4. **Web ä»‹é¢ç„¡æ³•è¨ªå•**
   - æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
   - ç¢ºèª Flask æ‡‰ç”¨æ­£å¸¸å•Ÿå‹•

## æ“´å±•åŠŸèƒ½

### å·²å¯¦ç¾åŠŸèƒ½
- âœ… CSV æª”æ¡ˆåŒ¯å…¥
- âœ… æ•¸æ“šæœå°‹èˆ‡éæ¿¾
- âœ… çµ±è¨ˆåˆ†æ
- âœ… Web ä»‹é¢
- âœ… API æ¥å£

### å¯æ“´å±•åŠŸèƒ½
- ğŸ“‹ æ•¸æ“šå°å‡º (Excel, PDF)
- ğŸ“‹ é€²éšåœ–è¡¨åˆ†æ
- ğŸ“‹ ç”¨æˆ¶æ¬Šé™ç®¡ç†
- ğŸ“‹ è‡ªå‹•åŒ–å ±å‘Šç”Ÿæˆ
- ğŸ“‹ æ•¸æ“šå‚™ä»½èˆ‡æ¢å¾©
- ğŸ“‹ åˆ†æ•£å¼éƒ¨ç½²æ”¯æ´

## æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. Python ç‰ˆæœ¬æ˜¯å¦æ­£ç¢º
2. ä¾è³´å¥—ä»¶æ˜¯å¦å®Œæ•´å®‰è£
3. è³‡æ–™åº«æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–
4. æª”æ¡ˆæ¬Šé™æ˜¯å¦æ­£ç¢ºè¨­å®š

## æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ï¼Œè©³è¦‹ LICENSE æª”æ¡ˆã€‚